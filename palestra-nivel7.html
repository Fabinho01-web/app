<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Imers√£o M√©todo Vida de Valor - Transforme sua vida atrav√©s da reflex√£o e crescimento pessoal">
    <title>Imers√£o M√©todo Vida de Valor - N√≠vel 7</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lora:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lora', serif;
            background: linear-gradient(135deg, #294b47, #335651, #3d615c);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
        }

        .container {
            background: #FAF7F0;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 100%;
            max-width: 750px;
            position: relative;
            overflow: hidden;
            animation: fadeIn 1s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Decorative elements */
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, #D4AF37, #FFD700, #B8860B);
        }

        .container::after {
            content: '';
            position: absolute;
            top: -40px;
            right: -40px;
            width: 128px;
            height: 128px;
            background: #DAA520;
            border-radius: 50%;
            opacity: 0.2;
        }

        .decorative-circle {
            position: absolute;
            bottom: -64px;
            left: -64px;
            width: 160px;
            height: 160px;
            background: #294b47;
            border-radius: 50%;
            opacity: 0.1;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .main-title {
            font-family: 'Cinzel', serif;
            font-size: 2.2rem;
            font-weight: 700;
            color: #B8860B;
            margin-bottom: 20px;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .intro-box {
            background: linear-gradient(180deg, rgba(248,241,233,0.95), rgba(212,175,55,0.05));
            padding: 25px;
            border: 2px solid #D4AF37;
            border-radius: 12px;
            margin-bottom: 30px;
            position: relative;
        }

        .intro-box::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: #D4AF37;
        }

        .bible-verse {
            color: #294b47;
            font-size: 1.2rem;
            font-style: italic;
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .citation {
            color: #3d615c;
            font-weight: 500;
            font-size: 0.95rem;
            margin-top: 12px;
        }

        .welcome-message {
            color: #1a2e2b;
            font-weight: 600;
            margin-top: 15px;
            font-size: 1.1rem;
            font-style: normal;
        }

        .level-title {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: #294b47;
            margin: 30px 0;
            letter-spacing: 0.5px;
        }

        .level-description {
            color: #3d615c;
            font-size: 1.1rem;
            background: white;
            padding: 20px;
            border: 1px solid #294b47;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* Questions */
        .questions-form {
            margin: 32px 0;
        }

        .question-group {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #294b47;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            opacity: 0;
            animation: slideUp 0.6s ease forwards;
            transition: all 0.5s ease;
        }

        .question-group:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            border-color: #B8860B;
        }

        .question-group:nth-child(1) { animation-delay: 0.2s; }
        .question-group:nth-child(2) { animation-delay: 0.4s; }
        .question-group:nth-child(3) { animation-delay: 0.6s; }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-label {
            display: block;
            font-family: 'Lora', serif;
            font-weight: 600;
            color: #294b47;
            margin-bottom: 12px;
            font-size: 1.15rem;
            line-height: 1.4;
        }

        .question-textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid #294b47;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Lora', serif;
            resize: vertical;
            min-height: 130px;
            outline: none;
            transition: all 0.3s ease;
        }

        .question-textarea:focus {
            border-color: #B8860B;
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.15);
        }

        .question-textarea.error {
            border-color: #8B4513;
            background-color: #FFF8F0;
        }

        .error-message {
            color: #8B4513;
            font-size: 0.85rem;
            margin-top: 6px;
            font-weight: 500;
            display: none;
        }

        /* Buttons */
        .button-group {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 18px;
            border: none;
            border-radius: 10px;
            font-family: 'Cinzel', serif;
            font-weight: 600;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            width: 100%;
            justify-content: center;
            margin: 15px 0;
        }

        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.5);
        }

        .btn-primary {
            background: linear-gradient(90deg, #D4AF37, #B8972A);
            color: #294b47;
            font-weight: 700;
        }

        .btn-primary:hover {
            background: linear-gradient(90deg, #B8860B, #DAA520);
        }

        .btn-secondary {
            background: #3d615c;
            color: white;
            width: auto;
            padding: 12px 30px;
            font-size: 1rem;
            border-radius: 8px;
            margin-left: 10px;
        }

        .btn-secondary:hover {
            background: #294b47;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 46, 43, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 16px;
        }

        .modal-content {
            background: #FAF7F0;
            padding: 35px;
            border-radius: 16px;
            border: 3px solid #D4AF37;
            text-align: center;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: scale(0.7);
            opacity: 0;
            animation: scaleIn 0.5s ease forwards;
            position: relative;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.7);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-icon {
            font-size: 120px;
            margin-bottom: 25px;
            position: relative;
            filter: drop-shadow(0 6px 12px rgba(0,0,0,0.3));
        }

        .sparkle {
            position: absolute;
            font-size: 30px;
            animation: sparkle 2s infinite;
        }

        .sparkle:nth-child(1) {
            top: 0;
            right: 25%;
            animation-delay: 0s;
        }

        .sparkle:nth-child(2) {
            bottom: 0;
            left: 25%;
            animation-delay: 1s;
        }

        @keyframes sparkle {
            0%, 100% { transform: rotate(0deg) scale(1); opacity: 1; }
            50% { transform: rotate(180deg) scale(1.2); opacity: 0.7; }
        }

        .modal-title {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: #294b47;
            margin-bottom: 15px;
        }

        .modal-text {
            color: #3d615c;
            font-size: 1.1rem;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: center;
        }

        .modal-content button {
            padding: 14px 35px;
            background: #D4AF37;
            color: #294b47;
            border: none;
            border-radius: 8px;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s, transform 0.3s;
        }

        .modal-content button:hover {
            background: #B8972A;
            transform: scale(1.06);
        }

        /* Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Canvas for Life Wheel */
        .life-wheel-canvas {
            display: none;
        }

        /* Loading state */
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .container {
                padding: 25px;
                max-width: 100%;
            }

            .main-title {
                font-size: 1.8rem;
            }

            .level-title {
                font-size: 1.5rem;
            }

            .question-group {
                padding: 20px;
            }

            .question-textarea {
                min-height: 110px;
                font-size: 0.95rem;
            }

            .btn {
                font-size: 1.1rem;
                padding: 14px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn-secondary {
                margin-left: 0;
                margin-top: 10px;
            }

            .modal-content {
                padding: 25px;
            }

            .modal-title {
                font-size: 1.5rem;
            }

            .modal-text {
                font-size: 1.125rem;
            }

            .modal-icon {
                width: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="decorative-circle"></div>
        
        <!-- Header -->
        <div class="header">
            <h1 class="main-title">Imers√£o M√©todo Vida de Valor</h1>
            
            <div class="intro-box">
                <blockquote class="bible-verse">
                    "Quanto √† antiga maneira de viver, voc√™s foram ensinados a despir-se do velho homem, 
                    que se corrompe por desejos enganosos, a serem renovados no modo de pensar e a revestir-se 
                    do novo homem, criado para ser semelhante a Deus em justi√ßa e em santidade provenientes da verdade."
                </blockquote>
                <cite class="citation">Ef√©sios 4:22-24</cite>
                <p class="welcome-message" id="welcomeMessage">
                    Parab√©ns por chegar ao final, Participante! Defina quem voc√™ quer se tornar.
                </p>
            </div>

            <h2 class="level-title">N√≠vel 7: Quem Voc√™ Quer se Tornar?</h2>
            <div class="level-description">
                <p>Reflita sobre quem voc√™ deseja se tornar em tr√™s dimens√µes principais da sua vida.</p>
            </div>
        </div>

        <!-- Questions Form -->
        <form class="questions-form" id="questionsForm">
            <div class="question-group">
                <label for="q1" class="question-label">
                    Quem voc√™ quer se tornar como indiv√≠duo?
                </label>
                <textarea 
                    id="q1" 
                    class="question-textarea"
                    placeholder="Descreva suas aspira√ß√µes pessoais, valores e caracter√≠sticas que deseja desenvolver..."
                    rows="6"
                ></textarea>
                <div class="error-message" id="q1Error">Por favor, compartilhe sua reflex√£o.</div>
            </div>

            <div class="question-group">
                <label for="q2" class="question-label">
                    Quem voc√™ quer se tornar para sua fam√≠lia?
                </label>
                <textarea 
                    id="q2" 
                    class="question-textarea"
                    placeholder="Reflita sobre o tipo de membro da fam√≠lia, parceiro(a) ou pai/m√£e que deseja ser..."
                    rows="6"
                ></textarea>
                <div class="error-message" id="q2Error">Por favor, compartilhe sua reflex√£o.</div>
            </div>

            <div class="question-group">
                <label for="q3" class="question-label">
                    Quem voc√™ quer se tornar em sua carreira?
                </label>
                <textarea 
                    id="q3" 
                    class="question-textarea"
                    placeholder="Visualize seu crescimento profissional, impacto que quer causar e legado que deseja deixar..."
                    rows="6"
                ></textarea>
                <div class="error-message" id="q3Error">Por favor, compartilhe sua reflex√£o.</div>
            </div>
        </form>

        <!-- Action Buttons -->
        <div class="button-group">
            <button class="btn btn-primary" onclick="submitLevel()">
                <span>‚úÖ</span>
                Concluir Imers√£o
            </button>
            
            <button class="btn btn-secondary" onclick="goBack()">
                <span>‚¨ÖÔ∏è</span>
                Voltar
            </button>
            
            <button class="btn btn-secondary" onclick="restartLevel()">
                <span>üîÑ</span>
                Recome√ßar
            </button>
        </div>

        <!-- Badge Modal -->
        <div class="modal" id="badgeModal">
            <div class="modal-content">
                <div class="modal-icon">
                    üèÜ
                    <div class="sparkle">‚ú®</div>
                    <div class="sparkle">‚≠ê</div>
                </div>
                
                <h3 class="modal-title">üéâ Transforma√ß√£o Conquistada! üéâ</h3>
                <p class="modal-text">
                    Voc√™ concluiu a Imers√£o M√©todo Vida de Valor! 
                    <br />Como presente especial, prepare-se para receber sua 
                    <span style="font-weight: bold; color: #B8860B;">"Ru√≠nas da Vida"</span>
                    personalizada com an√°lise completa!
                </p>
                
                <div class="modal-buttons">
                    <button class="btn btn-primary" onclick="generateLifeWheelPDF()" id="generatePdfBtn">
                        <span>üéÅ</span>
                        Receber Ru√≠nas da Vida em PDF
                    </button>
                    <button class="btn btn-secondary" onclick="goToConclusionPage()">
                        Ir para Conclus√£o
                    </button>
                </div>
            </div>
        </div>

        <!-- Hidden Canvas for Life Wheel -->
        <canvas id="lifeWheelCanvas" class="life-wheel-canvas" width="500" height="500"></canvas>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Global variables
        let responses = {};
        let participant = { name: 'Participante' };
        let errors = {};

        // Life areas for the wheel
        const lifeAreas = [
            'Complexos de inferioridade',
            'Filtros mentais negativos', 
            'Quebra financeira',
            'Abusos (sexual/verbal/f√≠sico)',
            'Traumas do passado',
            'Cren√ßas limitantes',
            'Ambientes problem√°ticos',
            'V√≠cios',
            'Falta de paternidade',
            'Relacionamentos destrutivos'
        ];

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            setupEventListeners();
        });

        function loadSavedData() {
            // Load responses
            const savedResponses = JSON.parse(localStorage.getItem('level7Responses') || '{}');
            responses = savedResponses;

            // Load participant info
            const participants = JSON.parse(localStorage.getItem('participants') || '[]');
            const latestParticipant = participants[participants.length - 1];
            if (latestParticipant) {
                participant = latestParticipant;
                document.getElementById('welcomeMessage').textContent = 
                    `Parab√©ns por chegar ao final, ${participant.name.split(' ')[0]}! Defina quem voc√™ quer se tornar.`;
            }

            // Fill form with saved responses
            ['q1', 'q2', 'q3'].forEach(id => {
                const element = document.getElementById(id);
                if (responses[id]) {
                    element.value = responses[id];
                }
            });
        }

        function setupEventListeners() {
            ['q1', 'q2', 'q3'].forEach(id => {
                const element = document.getElementById(id);
                element.addEventListener('input', function() {
                    handleInputChange(id, this.value);
                });
            });
        }

        function handleInputChange(questionId, value) {
            responses[questionId] = value;
            localStorage.setItem('level7Responses', JSON.stringify(responses));
            
            // Remove error if field is filled
            if (value.trim() && errors[questionId]) {
                clearError(questionId);
            }
        }

        function showError(questionId) {
            const textarea = document.getElementById(questionId);
            const errorElement = document.getElementById(questionId + 'Error');
            
            textarea.classList.add('error');
            errorElement.style.display = 'block';
            errors[questionId] = true;
        }

        function clearError(questionId) {
            const textarea = document.getElementById(questionId);
            const errorElement = document.getElementById(questionId + 'Error');
            
            textarea.classList.remove('error');
            errorElement.style.display = 'none';
            delete errors[questionId];
        }

        function validateForm() {
            let isValid = true;
            ['q1', 'q2', 'q3'].forEach(id => {
                if (!responses[id] || !responses[id].trim()) {
                    showError(id);
                    isValid = false;
                } else {
                    clearError(id);
                }
            });
            return isValid;
        }

        function submitLevel() {
            if (!validateForm()) {
                alert('Por favor, responda todas as quest√µes antes de prosseguir.');
                return;
            }

            localStorage.setItem('level7Completed', 'true');
            triggerConfetti();
            document.getElementById('badgeModal').style.display = 'flex';
        }

        function triggerConfetti() {
            const colors = ['#D4AF37', '#FFD700', '#B8860B', '#DAA520', '#294b47', '#3d615c'];
            const confettiContainer = document.createElement('div');
            confettiContainer.className = 'confetti-container';
            document.body.appendChild(confettiContainer);

            // Create confetti pieces
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.cssText = `
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    left: ${Math.random() * 100}%;
                    animation: confetti-fall ${Math.random() * 3 + 2}s linear infinite;
                    animation-delay: ${Math.random() * 2}s;
                    transform: rotate(${Math.random() * 360}deg);
                `;
                confettiContainer.appendChild(confetti);
            }

            // Remove after 5 seconds
            setTimeout(() => {
                confettiContainer.remove();
            }, 5000);
        }

        function restartLevel() {
            if (confirm('Deseja recome√ßar suas reflex√µes? Todo o progresso ser√° apagado.')) {
                responses = {};
                errors = {};
                localStorage.removeItem('level7Responses');
                localStorage.removeItem('level7Completed');
                
                ['q1', 'q2', 'q3'].forEach(id => {
                    document.getElementById(id).value = '';
                    clearError(id);
                });
            }
        }

        function goBack() {
            window.location.href = 'palestra-nivel6.html';
        }

        function goToConclusionPage() {
            // Close modal first
            document.getElementById('badgeModal').style.display = 'none';
            
            // Add a small delay for better UX, then redirect
            setTimeout(() => {
                window.location.href = 'conclusao.html';
            }, 500);
        }

        function closeBadgeModal() {
            document.getElementById('badgeModal').style.display = 'none';
            // Also redirect to conclusion page when closing modal
            setTimeout(() => {
                window.location.href = 'conclusao.html';
            }, 500);
        }

        // Life Wheel Generation Functions
        function getLevel5Data() {
            const level5Responses = JSON.parse(localStorage.getItem('level5Responses') || '{}');
            return lifeAreas.map((_, index) => {
                const score = parseInt(level5Responses[`q${index + 1}`]) || 0;
                return Math.max(1, Math.min(10, score));
            });
        }

        function drawLifeWheel() {
            const canvas = document.getElementById('lifeWheelCanvas');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 80;
            const scores = getLevel5Data();

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Background gradient
            const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius * 1.2);
            gradient.addColorStop(0, 'rgba(250, 247, 240, 0.1)');
            gradient.addColorStop(1, 'rgba(41, 75, 71, 0.05)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw concentric circles
            ctx.strokeStyle = 'rgba(41, 75, 71, 0.3)';
            ctx.lineWidth = 1;
            for (let i = 1; i <= 10; i++) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, (radius * i) / 10, 0, 2 * Math.PI);
                ctx.stroke();
            }

            // Draw radial lines
            const angleStep = (2 * Math.PI) / lifeAreas.length;
            for (let i = 0; i < lifeAreas.length; i++) {
                const angle = i * angleStep - Math.PI / 2;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(
                    centerX + Math.cos(angle) * radius,
                    centerY + Math.sin(angle) * radius
                );
                ctx.stroke();
            }

            // Draw filled area
            ctx.beginPath();
            for (let i = 0; i < lifeAreas.length; i++) {
                const angle = i * angleStep - Math.PI / 2;
                const score = scores[i];
                const distance = (radius * score) / 10;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            
            // Fill gradient - Verde musgo com dourado
            const fillGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
            fillGradient.addColorStop(0, 'rgba(212, 175, 55, 0.4)');
            fillGradient.addColorStop(0.5, 'rgba(61, 97, 92, 0.3)');
            fillGradient.addColorStop(1, 'rgba(41, 75, 71, 0.2)');
            ctx.fillStyle = fillGradient;
            ctx.fill();
            
            ctx.strokeStyle = '#294b47';
            ctx.lineWidth = 3;
            ctx.stroke();

            // Draw points
            for (let i = 0; i < lifeAreas.length; i++) {
                const angle = i * angleStep - Math.PI / 2;
                const score = scores[i];
                const distance = (radius * score) / 10;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, 2 * Math.PI);
                ctx.fillStyle = score > 7 ? '#8B4513' : score > 4 ? '#D4AF37' : '#3d615c';
                ctx.fill();
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            // Add labels with better positioning
            ctx.fillStyle = '#1a2e2b';
            ctx.font = 'bold 11px Arial';
            ctx.textAlign = 'center';
            
            for (let i = 0; i < lifeAreas.length; i++) {
                const angle = i * angleStep - Math.PI / 2;
                const labelDistance = radius + 40;
                const x = centerX + Math.cos(angle) * labelDistance;
                const y = centerY + Math.sin(angle) * labelDistance;
                
                // Adjust text alignment based on position
                if (Math.cos(angle) < -0.1) {
                    ctx.textAlign = 'right';
                } else if (Math.cos(angle) > 0.1) {
                    ctx.textAlign = 'left';
                } else {
                    ctx.textAlign = 'center';
                }
                
                // Break long text into multiple lines
                const words = lifeAreas[i].split(' ');
                if (words.length > 2) {
                    const firstLine = words.slice(0, 2).join(' ');
                    const secondLine = words.slice(2).join(' ');
                    ctx.fillText(firstLine, x, y - 6);
                    ctx.fillText(secondLine, x, y + 6);
                } else {
                    ctx.fillText(lifeAreas[i], x, y);
                }
                
                // Show score
                ctx.font = 'bold 10px Arial';
                ctx.fillStyle = '#294b47';
                ctx.fillText(`${scores[i]}`, x, y + 18);
                ctx.font = 'bold 11px Arial';
                ctx.fillStyle = '#1a2e2b';
            }

            // Add scale numbers
            ctx.fillStyle = '#3d615c';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            for (let i = 2; i <= 10; i += 2) {
                const distance = (radius * i) / 10;
                ctx.fillText(i.toString(), centerX + distance, centerY - 5);
            }
        }

        function generateAnalysis(scores) {
            const averageScore = scores.reduce((a, b) => a + b, 0) / scores.length;
            const highRiskAreas = lifeAreas.filter((_, i) => scores[i] >= 7);
            const moderateRiskAreas = lifeAreas.filter((_, i) => scores[i] >= 4 && scores[i] < 7);
            const lowRiskAreas = lifeAreas.filter((_, i) => scores[i] < 4);

            return {
                averageScore: averageScore.toFixed(1),
                highRiskAreas,
                moderateRiskAreas,
                lowRiskAreas,
                recommendations: generateRecommendations(highRiskAreas, moderateRiskAreas)
            };
        }

        function generateRecommendations(highRisk, moderateRisk) {
            const recommendations = [];
            
            if (highRisk.length > 0) {
                recommendations.push("üî¥ √ÅREAS DE ALTA PRIORIDADE:");
                recommendations.push("Estas √°reas requerem aten√ß√£o imediata e podem estar impactando significativamente sua qualidade de vida.");
                recommendations.push("");
                
                highRisk.forEach(area => {
                    const tips = getSpecificTips(area);
                    recommendations.push(`‚Ä¢ ${area}:`);
                    recommendations.push(`  ${tips}`);
                    recommendations.push("");
                });
            }

            if (moderateRisk.length > 0) {
                recommendations.push("üü° √ÅREAS DE ATEN√á√ÉO:");
                recommendations.push("Estas √°reas merecem cuidado preventivo para evitar que se tornem problemas maiores.");
                recommendations.push("");
                
                moderateRisk.forEach(area => {
                    const tips = getSpecificTips(area);
                    recommendations.push(`‚Ä¢ ${area}:`);
                    recommendations.push(`  ${tips}`);
                    recommendations.push("");
                });
            }

            recommendations.push("üí° RECOMENDA√á√ïES GERAIS:");
            recommendations.push("‚Ä¢ Busque apoio profissional (psic√≥logo, coach, mentor espiritual)");
            recommendations.push("‚Ä¢ Pratique a ora√ß√£o e medita√ß√£o na Palavra diariamente");
            recommendations.push("‚Ä¢ Cerque-se de pessoas que te edificam e apoiam seu crescimento");
            recommendations.push("‚Ä¢ Estabele√ßa pequenos objetivos di√°rios de melhoria");
            recommendations.push("‚Ä¢ Celebre cada conquista, por menor que seja");

            return recommendations;
        }

        function getSpecificTips(area) {
            const tips = {
                'Complexos de inferioridade': 'Trabalhe sua autoestima com afirma√ß√µes positivas baseadas em verdades b√≠blicas sobre sua identidade em Cristo.',
                'Filtros mentais negativos': 'Pratique a gratid√£o di√°ria e questione pensamentos autom√°ticos negativos.',
                'Quebra financeira': 'Busque educa√ß√£o financeira e estabele√ßa um or√ßamento realista. Ore por sabedoria na gest√£o dos recursos.',
                'Abusos (sexual/verbal/f√≠sico)': 'Procure ajuda profissional especializada. A cura √© poss√≠vel atrav√©s de terapia e apoio espiritual.',
                'Traumas do passado': 'Considere terapia para processar experi√™ncias dif√≠ceis. O perd√£o (de si mesmo e outros) √© fundamental.',
                'Cren√ßas limitantes': 'Identifique e questione pensamentos que limitam seu potencial. Substitua por verdades b√≠blicas.',
                'Ambientes problem√°ticos': 'Avalie relacionamentos t√≥xicos e ambientes que drenam sua energia. Busque espa√ßos saud√°veis.',
                'V√≠cios': 'Reconhe√ßa a necessidade de ajuda. Grupos de apoio e acompanhamento profissional s√£o essenciais.',
                'Falta de paternidade': 'Busque mentores e figuras paternas saud√°veis. Deus √© o Pai perfeito que supre essa necessidade.',
                'Relacionamentos destrutivos': 'Estabele√ßa limites saud√°veis. Invista em relacionamentos que te edificam e honram a Deus.'
            };
            return tips[area] || 'Busque orienta√ß√£o espec√≠fica para esta √°rea atrav√©s de estudo b√≠blico e aconselhamento.';
        }

        async function generateLifeWheelPDF() {
            const btn = document.getElementById('generatePdfBtn');
            const originalText = btn.innerHTML;
            
            // Show loading state
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner">‚ú®</span> Gerando seu presente...';
            
            try {
                const { jsPDF } = window.jspdf;
                const scores = getLevel5Data();
                const analysis = generateAnalysis(scores);
                
                const pdf = new jsPDF();
                const pageWidth = pdf.internal.pageSize.width;
                const pageHeight = pdf.internal.pageSize.height;
                let y = 30;

                // Header with verde musgo and dourado
                pdf.setFillColor(41, 75, 71); // Verde musgo
                pdf.rect(0, 0, pageWidth, 25, 'F');
                
                pdf.setTextColor(250, 247, 240); // Creme claro
                pdf.setFontSize(20);
                pdf.setFont('helvetica', 'bold');
                pdf.text('üåü RU√çNAS DA VIDA üåü', pageWidth / 2, 16, { align: 'center' });
                
                pdf.setTextColor(212, 175, 55); // Dourado
                pdf.setFontSize(12);
                pdf.text(`An√°lise Personalizada - ${participant.name}`, pageWidth / 2, 35, { align: 'center' });
                pdf.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')}`, pageWidth / 2, 45, { align: 'center' });
                
                y = 60;

                // Introduction
                pdf.setFontSize(14);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(41, 75, 71); // Verde musgo
                pdf.text('O QUE S√ÉO AS "RU√çNAS DA VIDA"?', 20, y);
                y += 10;
                
                pdf.setFontSize(11);
                pdf.setFont('helvetica', 'normal');
                pdf.setTextColor(40, 40, 40);
                const introText = 'As "Ru√≠nas da Vida" representam as √°reas de nossa exist√™ncia que foram danificadas por experi√™ncias, traumas, cren√ßas limitantes e circunst√¢ncias adversas. Este diagn√≥stico n√£o √© para nos condenar, mas para nos mostrar onde Deus quer trabalhar em nossa restaura√ß√£o e transforma√ß√£o.';
                const wrappedIntro = pdf.splitTextToSize(introText, pageWidth - 40);
                pdf.text(wrappedIntro, 20, y);
                y += wrappedIntro.length * 5 + 15;

                // Bible verse with verde musgo background
                pdf.setFillColor(250, 247, 240); // Creme
                pdf.rect(15, y - 5, pageWidth - 30, 25, 'F');
                pdf.setFontSize(11);
                pdf.setFont('helvetica', 'italic');
                pdf.setTextColor(41, 75, 71); // Verde musgo
                const verse = '"Ele restaura a minha alma e me guia pelas veredas da justi√ßa por amor do seu nome." - Salmos 23:3';
                const wrappedVerse = pdf.splitTextToSize(verse, pageWidth - 50);
                pdf.text(wrappedVerse, pageWidth / 2, y + 5, { align: 'center' });
                y += 35;

                // Add chart with better positioning
                drawLifeWheel();
                const canvas = document.getElementById('lifeWheelCanvas');
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 140;
                const imgHeight = 140;
                const imgX = (pageWidth - imgWidth) / 2;
                
                pdf.addImage(imgData, 'PNG', imgX, y, imgWidth, imgHeight);
                y += imgHeight + 20;

                // New page for analysis
                pdf.addPage();
                y = 30;

                // Detailed analysis with verde musgo header
                pdf.setFillColor(41, 75, 71);
                pdf.rect(0, 0, pageWidth, 20, 'F');
                pdf.setFontSize(16);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(250, 247, 240);
                pdf.text('üìä AN√ÅLISE DETALHADA', pageWidth / 2, 13, { align: 'center' });
                
                y = 35;
                pdf.setFontSize(12);
                pdf.setTextColor(40, 40, 40);
                pdf.text(`Sua pontua√ß√£o m√©dia: ${analysis.averageScore}/10`, 20, y);
                y += 10;

                // Score interpretation
                const avgScore = parseFloat(analysis.averageScore);
                let interpretation = '';
                if (avgScore >= 7) {
                    interpretation = 'Sua pontua√ß√£o indica √°reas que necessitam aten√ß√£o urgente. N√£o desanime - este √© o primeiro passo para a transforma√ß√£o!';
                } else if (avgScore >= 4) {
                    interpretation = 'Sua pontua√ß√£o mostra um equil√≠brio com algumas √°reas que merecem cuidado. Continue trabalhando em seu crescimento!';
                } else {
                    interpretation = 'Sua pontua√ß√£o indica boa estabilidade emocional. Mantenha os cuidados preventivos e continue crescendo!';
                }
                
                const wrappedInterpretation = pdf.splitTextToSize(interpretation, pageWidth - 40);
                pdf.text(wrappedInterpretation, 20, y);
                y += wrappedInterpretation.length * 5 + 15;

                // Area distribution with color coding
                pdf.setFontSize(14);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(41, 75, 71);
                pdf.text('üìà DISTRIBUI√á√ÉO POR √ÅREAS:', 20, y);
                y += 10;

                pdf.setFontSize(11);
                pdf.setFont('helvetica', 'normal');
                
                if (analysis.highRiskAreas.length > 0) {
                    pdf.setTextColor(139, 69, 19); // Marrom para alto risco
                    const highRiskText = `üî¥ Alto Risco (${analysis.highRiskAreas.length} √°reas): ${analysis.highRiskAreas.join(', ')}`;
                    const wrappedHighRisk = pdf.splitTextToSize(highRiskText, pageWidth - 40);
                    pdf.text(wrappedHighRisk, 20, y);
                    y += wrappedHighRisk.length * 5 + 3;
                }
                
                if (analysis.moderateRiskAreas.length > 0) {
                    pdf.setTextColor(212, 175, 55); // Dourado para risco moderado
                    const moderateRiskText = `üü° Risco Moderado (${analysis.moderateRiskAreas.length} √°reas): ${analysis.moderateRiskAreas.join(', ')}`;
                    const wrappedModerateRisk = pdf.splitTextToSize(moderateRiskText, pageWidth - 40);
                    pdf.text(wrappedModerateRisk, 20, y);
                    y += wrappedModerateRisk.length * 5 + 3;
                }
                
                if (analysis.lowRiskAreas.length > 0) {
                    pdf.setTextColor(61, 97, 92); // Verde para baixo risco
                    const lowRiskText = `üü¢ Baixo Risco (${analysis.lowRiskAreas.length} √°reas): ${analysis.lowRiskAreas.join(', ')}`;
                    const wrappedLowRisk = pdf.splitTextToSize(lowRiskText, pageWidth - 50);
                    pdf.text(wrappedLowRisk, 20, y);
                    y += wrappedLowRisk.length * 5 + 3;
                }

                y += 15;

                // Recommendations
                pdf.addPage();
                y = 30;
                
                // Header for recommendations
                pdf.setFillColor(212, 175, 55); // Dourado
                pdf.rect(0, 0, pageWidth, 20, 'F');
                pdf.setFontSize(16);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(250, 247, 240);
                pdf.text('üí° RECOMENDA√á√ïES PERSONALIZADAS', pageWidth / 2, 13, { align: 'center' });
                
                y = 35;
                pdf.setFontSize(11);
                pdf.setFont('helvetica', 'normal');
                pdf.setTextColor(40, 40, 40);

                analysis.recommendations.forEach(recommendation => {
                    if (recommendation.trim() === '') {
                        y += 5;
                        return;
                    }
                    
                    if (y > pageHeight - 30) {
                        pdf.addPage();
                        y = 30;
                    }
                    
                    const wrappedText = pdf.splitTextToSize(recommendation, pageWidth - 40);
                    pdf.text(wrappedText, 20, y);
                    y += wrappedText.length * 5 + 3;
                });

                // Final page - Hope message with verde musgo and dourado
                pdf.addPage();
                y = 60;
                
                pdf.setFillColor(41, 75, 71); // Verde musgo
                pdf.rect(15, y - 15, pageWidth - 30, 80, 'F');
                
                pdf.setFontSize(18);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(212, 175, 55); // Dourado
                pdf.text('üåü MENSAGEM DE ESPERAN√áA üåü', pageWidth / 2, y, { align: 'center' });
                y += 20;
                
                pdf.setFontSize(12);
                pdf.setFont('helvetica', 'normal');
                pdf.setTextColor(250, 247, 240); // Creme
                const hopeMessage = 'Lembre-se: as ru√≠nas n√£o definem quem voc√™ √©, mas mostram onde Deus quer trabalhar. Cada √°rea identificada √© uma oportunidade de crescimento e restaura√ß√£o. "Porque sou eu que conhe√ßo os planos que tenho para voc√™s, diz o Senhor, planos de faz√™-los prosperar e n√£o de causar dano, planos de dar esperan√ßa e um futuro." - Jeremias 29:11';
                const wrappedHope = pdf.splitTextToSize(hopeMessage, pageWidth - 50);
                pdf.text(wrappedHope, pageWidth / 2, y, { align: 'center' });
                y += wrappedHope.length * 6 + 20;
                
                pdf.setFontSize(14);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(212, 175, 55); // Dourado
                pdf.text('Sua jornada de transforma√ß√£o continua! üöÄ', pageWidth / 2, y, { align: 'center' });

                // Download PDF
                pdf.save(`Ruinas_da_Vida_${participant.name.replace(/\s/g, '_')}.pdf`);
                
                // After PDF is generated, redirect to conclusion page
                setTimeout(() => {
                    window.location.href = 'conclusao.html';
                }, 1000);
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Erro ao gerar o PDF. Tente novamente.');
            } finally {
                // Restore button
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
    </script>
</body>
</html>